<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz CAP AEPE</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --cream: #fdf6ec;
  --warm: #f5e6d0;
  --sand: #e8d5b7;
  --sand-dark: #d4bc95;
  --terracotta: #c1724f;
  --terra-dark: #9a5538;
  --sage: #6b8f71;
  --sage-light: #c8deca;
  --dusty: #7b9eb8;
  --navy: #2c3e50;
  --charcoal: #3d4a3e;
  --gold: #d4a843;
  --rose: #d4756b;
  --text: #2a2420;
  --text-muted: #7a6b5d;
  --r: 18px;
  --rsm: 10px;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'DM Sans',sans-serif;background:var(--cream);min-height:100vh;color:var(--text);overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background-image:radial-gradient(ellipse 80% 60% at 20% 10%,rgba(193,114,79,.07) 0%,transparent 60%),radial-gradient(ellipse 60% 80% at 80% 90%,rgba(107,143,113,.08) 0%,transparent 60%),url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23c1724f' fill-opacity='.025'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/svg%3E");pointer-events:none;z-index:0;}
#app{max-width:860px;margin:0 auto;padding:24px 20px;position:relative;z-index:1;}
h1,h2,h3,.syne{font-family:'Syne',sans-serif;}

/* ===== HOME ===== */
#home{animation:fadeUp .5s ease;}
.home-header{text-align:center;padding:48px 20px 36px;}
.logo-wrap{display:inline-flex;align-items:center;gap:14px;margin-bottom:16px;}
.logo-icon{width:64px;height:64px;background:var(--terracotta);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:32px;box-shadow:4px 4px 0 var(--terra-dark);}
.logo-text{font-family:'Syne',sans-serif;font-size:2.6rem;font-weight:800;color:var(--text);letter-spacing:-1px;line-height:1;}
.logo-text span{color:var(--terracotta);}
.tagline{color:var(--text-muted);font-size:1rem;margin-bottom:8px;}
.source-chip{display:inline-flex;align-items:center;gap:6px;background:var(--warm);border:1.5px solid var(--sand);border-radius:50px;padding:5px 14px;font-size:.78rem;font-weight:600;color:var(--terra-dark);margin-bottom:36px;}

.stats-strip{display:flex;justify-content:center;gap:12px;flex-wrap:wrap;margin-bottom:40px;}
.stat-pill{background:white;border:1.5px solid var(--sand);border-radius:50px;padding:8px 20px;font-size:.85rem;font-weight:600;color:var(--text-muted);display:flex;align-items:center;gap:7px;box-shadow:2px 2px 0 var(--sand);}
.stat-pill strong{color:var(--text);}

.section-label{font-family:'Syne',sans-serif;font-size:.7rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--text-muted);margin-bottom:14px;display:flex;align-items:center;gap:10px;}
.section-label::after{content:'';flex:1;height:1px;background:var(--sand);}

.mode-cards{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px;}
.mode-card{border-radius:var(--r);padding:24px 22px;cursor:pointer;transition:all .22s cubic-bezier(.34,1.56,.64,1);border:2px solid transparent;}
.mode-card:hover{transform:translateY(-4px);}
.mode-card:active{transform:translateY(-1px) scale(.99);}
.mode-card.exam{background:var(--navy);color:white;box-shadow:4px 4px 0 var(--charcoal);}
.mode-card.exam:hover{box-shadow:6px 6px 0 var(--charcoal);}
.mode-card.rapid{background:var(--terracotta);color:white;box-shadow:4px 4px 0 var(--terra-dark);}
.mode-card.rapid:hover{box-shadow:6px 6px 0 var(--terra-dark);}
.mc-icon{font-size:2.2rem;margin-bottom:10px;}
.mc-title{font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:700;margin-bottom:5px;}
.mc-sub{font-size:.78rem;opacity:.75;}

.cat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(195px,1fr));gap:11px;}
.cat-card{background:white;border:1.5px solid var(--sand);border-radius:var(--r);padding:18px 16px;cursor:pointer;transition:all .22s cubic-bezier(.34,1.56,.64,1);position:relative;overflow:hidden;}
.cat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--terracotta);transform:scaleX(0);transform-origin:left;transition:transform .2s;}
.cat-card:hover{border-color:var(--terracotta);transform:translateY(-3px);box-shadow:3px 3px 0 var(--sand);}
.cat-card:hover::before{transform:scaleX(1);}
.cat-emoji{font-size:1.8rem;margin-bottom:8px;}
.cat-name{font-family:'Syne',sans-serif;font-size:.88rem;font-weight:700;color:var(--text);margin-bottom:5px;line-height:1.3;}
.cat-cnt{font-size:.74rem;color:var(--text-muted);font-weight:500;}
.cat-prog{margin-top:10px;height:3px;background:var(--warm);border-radius:3px;overflow:hidden;}
.cat-prog-fill{height:100%;background:var(--sage);border-radius:3px;transition:width .6s;}

/* ===== QUIZ ===== */
#quiz{display:none;animation:fadeUp .3s ease;}
.quiz-header{background:white;border:1.5px solid var(--sand);border-radius:var(--r);padding:14px 20px;margin-bottom:20px;display:flex;align-items:center;gap:16px;flex-wrap:wrap;box-shadow:2px 2px 0 var(--sand);}
.back-btn{font-family:'Syne',sans-serif;font-size:.82rem;font-weight:700;background:none;border:1.5px solid var(--sand);border-radius:var(--rsm);padding:7px 13px;cursor:pointer;color:var(--text-muted);transition:all .18s;white-space:nowrap;}
.back-btn:hover{border-color:var(--terracotta);color:var(--terracotta);}
.progress-block{flex:1;min-width:140px;}
.progress-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:7px;}
.progress-count{font-family:'Syne',sans-serif;font-size:.85rem;font-weight:700;color:var(--text);}
.cat-badge{font-size:.7rem;font-weight:600;background:var(--warm);color:var(--terra-dark);border-radius:50px;padding:3px 10px;border:1px solid var(--sand);}
.progress-bar{height:6px;background:var(--warm);border-radius:6px;overflow:hidden;}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--sage),var(--terracotta));border-radius:6px;transition:width .5s cubic-bezier(.4,0,.2,1);}
.score-display{display:flex;align-items:center;gap:6px;font-family:'Syne',sans-serif;font-weight:700;font-size:1.1rem;color:var(--sage);white-space:nowrap;}
.score-dot{width:10px;height:10px;border-radius:50%;background:var(--sage);}

.qcard{background:white;border:1.5px solid var(--sand);border-radius:var(--r);padding:32px 30px;box-shadow:3px 3px 0 var(--sand);animation:slideUp .35s cubic-bezier(.34,1.56,.64,1);}
.q-meta{display:flex;align-items:center;gap:10px;margin-bottom:16px;flex-wrap:wrap;}
.q-number{font-family:'Syne',sans-serif;font-size:.7rem;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--text-muted);}
.q-source-tag{font-size:.72rem;font-weight:600;background:var(--warm);color:var(--terra-dark);border-radius:6px;padding:3px 9px;border:1px solid var(--sand);}
.q-text{font-family:'Syne',sans-serif;font-size:1.18rem;font-weight:600;line-height:1.55;margin-bottom:26px;color:var(--text);}

.opts{display:flex;flex-direction:column;gap:10px;}
.opt{padding:14px 18px;border-radius:var(--rsm);border:1.5px solid var(--sand);cursor:pointer;font-size:.91rem;font-weight:500;transition:all .18s;background:var(--cream);display:flex;align-items:flex-start;gap:12px;line-height:1.4;}
.opt-letter{width:28px;height:28px;border-radius:8px;background:var(--warm);border:1.5px solid var(--sand);display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:.78rem;font-weight:800;color:var(--text-muted);flex-shrink:0;transition:all .18s;margin-top:1px;}
.opt:hover:not(.disabled){border-color:var(--terracotta);background:rgba(193,114,79,.04);transform:translateX(4px);}
.opt:hover:not(.disabled) .opt-letter{background:var(--terracotta);border-color:var(--terracotta);color:white;}
.opt.correct{border-color:var(--sage);background:rgba(107,143,113,.08);}
.opt.correct .opt-letter{background:var(--sage);border-color:var(--sage);color:white;}
.opt.wrong{border-color:var(--rose);background:rgba(212,117,107,.07);}
.opt.wrong .opt-letter{background:var(--rose);border-color:var(--rose);color:white;}
.opt.disabled{cursor:default;}
.opt.disabled:not(.correct):not(.wrong){opacity:.55;}
.opt-text{flex:1;}

.feedback{margin-top:18px;border-radius:var(--rsm);padding:16px 18px;font-size:.88rem;line-height:1.65;display:none;animation:fadeIn .3s;border-left:4px solid;}
.feedback.show{display:block;}
.feedback.correct-fb{background:rgba(107,143,113,.1);border-color:var(--sage);}
.feedback.wrong-fb{background:rgba(212,175,74,.1);border-color:var(--gold);}
.fb-head{font-family:'Syne',sans-serif;font-weight:700;font-size:.92rem;margin-bottom:6px;}
.correct-fb .fb-head{color:var(--sage);}
.wrong-fb .fb-head{color:var(--gold);}

.next-btn{width:100%;padding:16px;border-radius:var(--rsm);border:none;font-family:'Syne',sans-serif;font-size:1rem;font-weight:700;cursor:pointer;background:var(--navy);color:white;margin-top:16px;display:none;transition:all .2s;box-shadow:3px 3px 0 var(--charcoal);letter-spacing:.5px;}
.next-btn:hover{transform:translateY(-2px);box-shadow:5px 5px 0 var(--charcoal);}
.next-btn:active{transform:translateY(0);box-shadow:2px 2px 0 var(--charcoal);}
.next-btn.show{display:block;animation:fadeIn .3s;}

/* ===== RESULTS ===== */
#results{display:none;animation:fadeUp .4s ease;}
.results-card{background:white;border:1.5px solid var(--sand);border-radius:var(--r);padding:40px 32px;box-shadow:4px 4px 0 var(--sand);margin-bottom:16px;text-align:center;}
.score-visual{width:160px;height:160px;margin:0 auto 28px;position:relative;}
.score-svg{transform:rotate(-90deg);}
.score-track{fill:none;stroke:var(--warm);stroke-width:10;}
.score-arc{fill:none;stroke:var(--terracotta);stroke-width:10;stroke-linecap:round;stroke-dasharray:440;stroke-dashoffset:440;transition:stroke-dashoffset 1.2s cubic-bezier(.4,0,.2,1);}
.score-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.score-pct{font-family:'Syne',sans-serif;font-size:2.2rem;font-weight:800;color:var(--text);line-height:1;}
.score-frac{font-size:.8rem;color:var(--text-muted);font-weight:500;margin-top:3px;}
.result-title{font-family:'Syne',sans-serif;font-size:1.8rem;font-weight:800;margin-bottom:8px;color:var(--text);}
.result-sub{color:var(--text-muted);font-size:.92rem;line-height:1.6;margin-bottom:28px;max-width:480px;margin-left:auto;margin-right:auto;}
.breakdown-title{font-family:'Syne',sans-serif;font-size:.7rem;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--text-muted);margin-bottom:14px;text-align:left;}
.breakdown-list{text-align:left;}
.bd-row{display:flex;align-items:center;gap:12px;margin-bottom:9px;padding:8px 12px;background:var(--cream);border-radius:8px;border:1px solid var(--warm);}
.bd-emoji{font-size:1rem;flex-shrink:0;}
.bd-name{flex:1;font-size:.8rem;font-weight:600;color:var(--text);line-height:1.3;}
.bd-bar-wrap{width:80px;height:5px;background:var(--warm);border-radius:5px;overflow:hidden;}
.bd-bar-fill{height:100%;border-radius:5px;}
.bd-score{font-size:.78rem;font-weight:700;color:var(--text-muted);width:36px;text-align:right;white-space:nowrap;}

.action-row{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;}
.btn{padding:14px 28px;border-radius:var(--rsm);border:none;font-family:'Syne',sans-serif;font-size:.95rem;font-weight:700;cursor:pointer;transition:all .2s;letter-spacing:.3px;}
.btn-primary{background:var(--terracotta);color:white;box-shadow:3px 3px 0 var(--terra-dark);}
.btn-primary:hover{transform:translateY(-2px);box-shadow:5px 5px 0 var(--terra-dark);}
.btn-secondary{background:white;color:var(--text);border:1.5px solid var(--sand);box-shadow:2px 2px 0 var(--sand);}
.btn-secondary:hover{transform:translateY(-2px);border-color:var(--navy);color:var(--navy);}

@keyframes fadeUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
@keyframes slideUp{from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}

@media(max-width:520px){
  .logo-text{font-size:1.8rem;}
  .mode-cards{grid-template-columns:1fr;}
  .qcard{padding:22px 18px;}
  .q-text{font-size:1rem;}
  .opt{font-size:.87rem;}
  .results-card{padding:28px 18px;}
}
</style>
</head>
<body>
<div id="app">

<!-- ===== HOME ===== -->
<div id="home">
  <div class="home-header">
    <div class="logo-wrap">
      <div class="logo-icon">üçº</div>
      <div class="logo-text">Quiz <span>CAP</span> AEPE</div>
    </div>
    <p class="tagline">R√©vise avec des questions tir√©es des fiches de cours officielles</p>
    <div class="source-chip">üìö formationcappetiteenfance.com</div>
  </div>
  <div class="stats-strip">
    <div class="stat-pill">‚úÖ <strong id="totalQ">0</strong> questions</div>
    <div class="stat-pill">üìÇ <strong id="totalCat">0</strong> th√®mes</div>
    <div class="stat-pill">üèÜ Record : <strong id="bestScore">‚Äì</strong></div>
  </div>
  <div class="section-label">Mode d'entra√Ænement</div>
  <div class="mode-cards">
    <div class="mode-card exam" onclick="startQuiz('exam')">
      <div class="mc-icon">üéì</div>
      <div class="mc-title">Examen Complet</div>
      <div class="mc-sub">Toutes les questions m√©lang√©es</div>
    </div>
    <div class="mode-card rapid" onclick="startQuiz('rapid')">
      <div class="mc-icon">‚ö°</div>
      <div class="mc-title">Session Rapide</div>
      <div class="mc-sub">20 questions al√©atoires</div>
    </div>
  </div>
  <div class="section-label" style="margin-top:28px">Par th√®me</div>
  <div class="cat-grid" id="catGrid"></div>
</div>

<!-- ===== QUIZ ===== -->
<div id="quiz">
  <div class="quiz-header">
    <button class="back-btn" onclick="goHome()">‚Üê Accueil</button>
    <div class="progress-block">
      <div class="progress-meta">
        <span class="progress-count" id="qNum">1/50</span>
        <span class="cat-badge" id="catBadge">‚Äì</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="progFill" style="width:0%"></div></div>
    </div>
    <div class="score-display"><div class="score-dot"></div><span id="scoreDisp">0</span></div>
  </div>
  <div class="qcard" id="qcard">
    <div class="q-meta">
      <span class="q-number" id="qNumInner">Question 1</span>
      <span class="q-source-tag" id="qSourceTag">‚Äì</span>
    </div>
    <div class="q-text" id="qText">‚Äì</div>
    <div class="opts" id="optsContainer"></div>
    <div class="feedback" id="feedbackEl">
      <div class="fb-head" id="fbHead"></div>
      <div id="fbBody"></div>
    </div>
    <button class="next-btn" id="nextBtn" onclick="nextQ()">Question suivante ‚Üí</button>
  </div>
</div>

<!-- ===== RESULTS ===== -->
<div id="results">
  <div class="results-card">
    <div class="score-visual">
      <svg class="score-svg" viewBox="0 0 160 160" width="160" height="160">
        <circle class="score-track" cx="80" cy="80" r="70"/>
        <circle class="score-arc" id="scoreArc" cx="80" cy="80" r="70"/>
      </svg>
      <div class="score-center">
        <div class="score-pct" id="resPct">0%</div>
        <div class="score-frac" id="resFrac">0/0</div>
      </div>
    </div>
    <div class="result-title" id="resTitle">‚Äì</div>
    <div class="result-sub" id="resSub">‚Äì</div>
    <div class="breakdown-title">R√©sultats par th√®me</div>
    <div class="breakdown-list" id="breakdown"></div>
  </div>
  <div class="action-row">
    <button class="btn btn-primary" onclick="goHome()">üè† Accueil</button>
    <button class="btn btn-secondary" id="replayBtn">üîÑ Rejouer</button>
  </div>
</div>

</div>

<!-- ============================================================
     Les questions sont r√©parties dans plusieurs fichiers :
       ‚Ä¢ questions.js   ‚Äî Biologie, Nutrition, SMS, Parasitoses
       ‚Ä¢ questions2.js  ‚Äî D√©veloppement enfant, Psychomotricit√©, Famille, R√©glementation
     Pour ajouter un fichier : cr√©ez questions3.js avec une variable
     QUESTIONS_3 = [...], ajoutez un <script src="questions3.js">
     et ajoutez QUESTIONS_3 dans le tableau ALL_QUESTION_FILES ci-dessous.
     Placez tous les fichiers dans le m√™me dossier et ouvrez index.html.
============================================================ -->
<script src="questions.js"></script>
<script src="questions2.js"></script>
<script>
// ============================================================
// LOGIQUE DU QUIZ ‚Äî index.html
// Fusion automatique de tous les fichiers de questions
// ============================================================

// ‚¨á Ajoutez ici chaque nouvelle variable de questions
const ALL_QUESTION_FILES = [
  typeof QUESTIONS_1 !== 'undefined' ? QUESTIONS_1 : [],
  typeof QUESTIONS_2 !== 'undefined' ? QUESTIONS_2 : [],
  // typeof QUESTIONS_3 !== 'undefined' ? QUESTIONS_3 : [],
];
const QUESTIONS = ALL_QUESTION_FILES.flat();

const LETTERS = ['A','B','C','D'];
let curMode='all', quiz=[], idx=0, score=0, answered=false, catStats={};
let bestScores={};
try{bestScores=JSON.parse(localStorage.getItem('cap_scores')||'{}');}catch(e){bestScores={};}

function saveScores(){try{localStorage.setItem('cap_scores',JSON.stringify(bestScores));}catch(e){}}

function shuffleOptions(q){
  const c=q.opts.map((o,i)=>({text:o,isCorrect:i===q.ans}));
  for(let i=c.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[c[i],c[j]]=[c[j],c[i]];}
  const newAns=c.findIndex(o=>o.isCorrect);
  return{opts:c.map(o=>o.text),ans:newAns};
}

function shuffle(a){
  const b=[...a];
  for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];}
  return b;
}

function buildHome(){
  const cats=[...new Set(QUESTIONS.map(q=>q.cat))];
  document.getElementById('totalQ').textContent=QUESTIONS.length;
  document.getElementById('totalCat').textContent=cats.length;
  const gb=Object.entries(bestScores).filter(([k])=>k==='exam'||k==='rapid').map(([,v])=>v);
  document.getElementById('bestScore').textContent=gb.length?Math.max(...gb)+'%':'‚Äì';
  const grid=document.getElementById('catGrid');
  grid.innerHTML='';
  cats.forEach(cat=>{
    const count=QUESTIONS.filter(q=>q.cat===cat).length;
    const emoji=cat.split(' ')[0];
    const name=cat.replace(/^[^\s]+\s/,'');
    const best=bestScores['c:'+cat]||0;
    const div=document.createElement('div');
    div.className='cat-card';
    div.innerHTML=`<div class="cat-emoji">${emoji}</div><div class="cat-name">${name}</div><div class="cat-cnt">${count} question${count>1?'s':''}</div><div class="cat-prog"><div class="cat-prog-fill" style="width:${best}%"></div></div>`;
    div.onclick=()=>startQuiz('c:'+cat);
    grid.appendChild(div);
  });
}

function startQuiz(mode){
  curMode=mode;
  let pool;
  if(mode==='exam') pool=shuffle(QUESTIONS);
  else if(mode==='rapid') pool=shuffle(QUESTIONS).slice(0,20);
  else{const catKey=mode.replace('c:','');pool=shuffle(QUESTIONS.filter(q=>q.cat===catKey));}
  quiz=pool.map(q=>{const s=shuffleOptions(q);return{...q,...s};});
  idx=0;score=0;answered=false;catStats={};
  document.getElementById('home').style.display='none';
  document.getElementById('quiz').style.display='block';
  document.getElementById('results').style.display='none';
  showQ();
}

function goHome(){
  document.getElementById('home').style.display='block';
  document.getElementById('quiz').style.display='none';
  document.getElementById('results').style.display='none';
  buildHome();
}

function showQ(){
  answered=false;
  const q=quiz[idx],total=quiz.length;
  document.getElementById('qNum').textContent=`${idx+1} / ${total}`;
  document.getElementById('qNumInner').textContent=`Question ${idx+1}`;
  const catShort=q.cat.replace(/^[^\s]+\s/,'').split('‚Äì')[1]?.trim()||q.cat.replace(/^[^\s]+\s/,'');
  document.getElementById('catBadge').textContent=catShort;
  document.getElementById('qSourceTag').textContent='üìñ '+q.src;
  document.getElementById('qText').textContent=q.q;
  document.getElementById('progFill').style.width=Math.round(idx/total*100)+'%';
  document.getElementById('scoreDisp').textContent=score;
  const c=document.getElementById('optsContainer');
  c.innerHTML='';
  q.opts.forEach((opt,i)=>{
    const d=document.createElement('div');
    d.className='opt';
    d.innerHTML=`<span class="opt-letter">${LETTERS[i]}</span><span class="opt-text">${opt}</span>`;
    d.onclick=()=>selectAnswer(i,d);
    c.appendChild(d);
  });
  document.getElementById('feedbackEl').className='feedback';
  document.getElementById('nextBtn').className='next-btn';
  const card=document.getElementById('qcard');
  card.style.animation='none';
  requestAnimationFrame(()=>{card.style.animation='';});
}

function selectAnswer(i,el){
  if(answered)return;
  answered=true;
  const q=quiz[idx];
  document.querySelectorAll('.opt').forEach(o=>o.classList.add('disabled'));
  if(!catStats[q.cat])catStats[q.cat]={ok:0,tot:0};
  catStats[q.cat].tot++;
  const fb=document.getElementById('feedbackEl');
  if(i===q.ans){
    score++;el.classList.add('correct');
    fb.className='feedback correct-fb show';
    document.getElementById('fbHead').textContent='‚úÖ Bonne r√©ponse !';
    catStats[q.cat].ok++;
  }else{
    el.classList.add('wrong');
    document.querySelectorAll('.opt')[q.ans].classList.add('correct');
    fb.className='feedback wrong-fb show';
    document.getElementById('fbHead').textContent='‚ùå Pas tout √† fait‚Ä¶';
  }
  document.getElementById('fbBody').textContent=(i!==q.ans?'‚úî Bonne r√©ponse : "'+q.opts[q.ans]+'". ':'')+q.exp;
  document.getElementById('scoreDisp').textContent=score;
  const nb=document.getElementById('nextBtn');
  nb.textContent=idx<quiz.length-1?'Question suivante ‚Üí':'Voir mes r√©sultats üèÅ';
  nb.className='next-btn show';
}

function nextQ(){
  idx++;
  if(idx>=quiz.length)showResults();
  else showQ();
}

function showResults(){
  document.getElementById('quiz').style.display='none';
  document.getElementById('results').style.display='block';
  const total=quiz.length,pct=Math.round(score/total*100);
  document.getElementById('resPct').textContent=pct+'%';
  document.getElementById('resFrac').textContent=score+' / '+total;
  const circ=2*Math.PI*70;
  const arc=document.getElementById('scoreArc');
  arc.style.strokeDasharray=circ;arc.style.strokeDashoffset=circ;
  arc.style.stroke=pct>=80?'#6b8f71':pct>=60?'#d4a843':'#c1724f';
  setTimeout(()=>{arc.style.strokeDashoffset=circ-(pct/100)*circ;},100);
  let title,sub;
  if(pct>=90){title='üèÜ Excellent !';sub='Parfaite ma√Ætrise du programme. Vous √™tes pr√™te pour l\'examen !';}
  else if(pct>=75){title='üéâ Tr√®s bien !';sub='Tr√®s bon niveau. Revoyez les th√®mes les plus faibles pour √™tre parfaite.';}
  else if(pct>=60){title='üëç Bien !';sub='Bonnes bases. Concentrez-vous sur vos points faibles.';}
  else if(pct>=40){title='üìö En progression';sub='Relisez les fiches et revenez vous tester !';}
  else{title='üí™ Allez, on r√©vise !';sub='Recommencez th√®me par th√®me pour bien ancrer les notions cl√©s.';}
  document.getElementById('resTitle').textContent=title;
  document.getElementById('resSub').textContent=`${score} bonne${score>1?'s':''} r√©ponse${score>1?'s':''} sur ${total} ‚Äî ${sub}`;
  bestScores[curMode]=Math.max(pct,bestScores[curMode]||0);
  Object.keys(catStats).forEach(cat=>{
    const p=Math.round(catStats[cat].ok/catStats[cat].tot*100);
    bestScores['c:'+cat]=Math.max(p,bestScores['c:'+cat]||0);
  });
  saveScores();
  const bd=document.getElementById('breakdown');
  bd.innerHTML='';
  Object.entries(catStats).forEach(([cat,s])=>{
    const p=Math.round(s.ok/s.tot*100);
    const emoji=cat.split(' ')[0];
    const name=cat.replace(/^[^\s]+\s/,'');
    const color=p>=70?'#6b8f71':p>=40?'#d4a843':'#c1724f';
    bd.innerHTML+=`<div class="bd-row"><div class="bd-emoji">${emoji}</div><div class="bd-name">${name}</div><div class="bd-bar-wrap"><div class="bd-bar-fill" style="width:${p}%;background:${color}"></div></div><div class="bd-score">${s.ok}/${s.tot}</div></div>`;
  });
  document.getElementById('replayBtn').onclick=()=>startQuiz(curMode);
}

buildHome();
</script>
</body>
</html>
